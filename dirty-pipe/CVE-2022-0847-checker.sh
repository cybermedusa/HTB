#!/bin/bash
# Linux Kernel 5.8.0 < 5.16.11 Dirty Pipe CVE-2022-0847 by cybermedusa
# patched versions: 5.16.11, 5.15.25, 5.10.102

# kernel version major.minor.patch
KERNEL_VERSION_MAJOR=$(uname -r | cut -d'-' -f1 | cut -d'.' -f1)
KERNEL_VERSION_MINOR=$(uname -r | cut -d'-' -f1 | cut -d'.' -f2)
KERNEL_VERSION_PATCH=$(uname -r | cut -d'-' -f1 | cut -d'.' -f3)
KERNEL_VERSION=$KERNEL_VERSION_MAJOR.$KERNEL_VERSION_MINOR.$KERNEL_VERSION_PATCH
echo $KERNEL_VERSION

EXCLUDED=("5.15.25", "5.10.102", "5.16.11")

# check if version is in EXCLUDED
for version in "${EXCLUDED[@]}"; do
    if [[ $KERNEL_VERSION == $version ]]; then
        echo "not vulnerable"
        break
    fi
done

MIN_AND_MAX_MAJOR=5
MIN_MINOR=8
MIN_PATCH=0
MAX_MINOR=16
MAX_PATCH=11


if (( (KERNEL_VERSION_MAJOR == MIN_AND_MAX_MAJOR) && (KERNEL_VERSION_MINOR >= MIN_MINOR && KERNEL_VERSION_MINOR <= MAX_MINOR) &&
      (KERNEL_VERSION_PATCH >= MIN_PATCH && KERNEL_VERSION_PATCH < MAX_PATCH))); then
    echo "vulnerable"
else   
    echo "not vulnerable"
fi

